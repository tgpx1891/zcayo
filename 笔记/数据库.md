### MySQL事务

事务是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位

数据库事务拥有以下四个特性（ACID）

- 原子性（Atomicity）：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。
- 一致性（Consistency）：事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。
- 隔离性（Isolation）：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。
- 持久性（Durability）：已被提交的事务对数据库的修改应该永久保存在数据库中

在MySQL中，事务以 BEGIN WORK 语句开始开始工作，并使用 COMMIT 或 ROLLBACK 语句结束。SQL 命令在开始和结束语句之间构成大量事务。可以通过设置 AUTOCOMMIT 这个会话变量控制事务的行为。如果 AUTOCOMMIT 设置为1(默认值)，那么每个 SQL 语句(在事务或不在事务)被认为是一个完整的事务并提交，当 AUTOCOMMIT 设置为0，通过发出 SET AUTOCOMMIT=0 命令, 随后的一系列语句就像一个事务，但并没有任何活动被提交直到一个明确的发出 COMMIT 语句

### 事务的隔离级别

|         事务隔离级别         | 脏读 | 不可重复读 | 幻读 |
| :--------------------------: | :--: | :--------: | :--: |
| 未提交读（read-uncommitted） |  是  |     是     |  是  |
|   提交读（read-committed）   |  否  |     是     |  是  |
| 可重复读（repeatable-read）  |  否  |     否     |  是  |
|    串行化（serializable）    |  否  |     否     |  否  |

- 未提交读(Read Uncommitted)：允许脏读，也就是可能读取到其他会话中未提交事务修改的数据。
- 提交读(Read Committed)：只能读取到已经提交的数据。Oracle等多数数据库默认都是该级别 (不重复读)。
- 可重复读(Repeated Read)：可重复读。在同一个事务内的查询都是事务开始时刻一致的，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻象读。
- 串行读(Serializable)：完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞

不可重复读：事务2提交成功，它所做的修改已经可见。然而，事务1已经读取了一个其它的值。在序列化和可重复读的隔离级别中，数据库管理系统会返回旧值

幻读：当两个完全相同的查询执行时，第二次查询所返回的结果集跟第一个查询不相同

### MySQL行级锁和表级锁

- 行级锁：行级锁是Mysql中锁定粒度最细的一种锁，表示只针对当前操作的行进行加锁
- 表级锁：表级锁是MySQL中锁定粒度最大的一种锁，表示对当前操作的整张表加锁。表级锁定分为表共享读锁（共享锁）与表独占写锁（排他锁）

MySQL 数据库的两种引擎区别

InnoDB是聚集索引，支持事务，支持行级锁（默认）和表级锁；MyISAM是非聚集索引，不支持事务，只支持表级锁

### 聚集索引

- 聚集索引中键值的逻辑顺序决定了表中相应行的物理顺序，由于聚集索引规定数据在表中的物理存储顺序，因此一个表只能包含一个聚集索引，但该索引可以包含多个列（组合索引），就像电话簿按姓氏和名字进行组织一样。
- 如果对从表中检索的数据进行排序时经常要用到某一列，则可以将该表在该列上聚集（物理排序），避免每次查询该列时都进行排序。
- 如果不创建索引，系统会自动创建一个隐含列作为表的聚集索引，MySQL里主键就是聚集索引

### 如何对数据库作优化

1. 调整数据结构的设计，对于经常访问的数据库表建立索引
2. 调整优化SQL语句
3. 调整服务器内存分配
4. 调整硬盘Ｉ/Ｏ，DBA 可以将组成同一个表空间的数据文件放在不同的硬盘上，做到硬盘之间Ｉ／Ｏ负载均衡。 